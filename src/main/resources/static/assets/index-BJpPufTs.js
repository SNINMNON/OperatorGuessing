import{r as k,H as C,I as b,J as a,K as s,L as t,j as f,c as x,m as Z,o as ee,G as U,M as z,N as B,F as h,O as te,P as F,w as W,Q as q,n as ae,R as se,S as oe}from"./vue-vendor-CfuPwfJT.js";import{N as ne,B as w,a as S,b as re,c as le,d as ue,u as A,e as j,f as H,g as N,h as E,i as V,j as ie,k as de,l as ce,m as pe,n as fe}from"./naive-ui-Bo9_qUcw.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))e(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&e(u)}).observe(document,{childList:!0,subtree:!0});function d(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerPolicy&&(n.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?n.credentials="include":l.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(l){if(l.ep)return;l.ep=!0;const n=d(l);fetch(l.href,n)}})();const D="/api";async function K(c){return await(await fetch(`${D}/start?rarity=${c}`,{credentials:"include"})).json()}async function ye(c){return await(await fetch(`${D}/suggest?query=${encodeURIComponent(c)}`,{credentials:"include"})).json()}async function me(c){return await(await fetch(`${D}/guess?name=${encodeURIComponent(c)}`,{method:"POST",credentials:"include"})).json()}const M=(c,o)=>{const d=c.__vccOpts||c;for(const[e,l]of o)d[e]=l;return d},ve={__name:"StartScreen",emits:["start","rarity","back"],setup(c,{emit:o}){const d=o,e=k(0),l=[{label:"任意星级",value:0},...Array.from({length:6},(u,p)=>({label:`${p+1}星`,value:p+1}))];async function n(){await K(e.value),d("rarity",e.value),d("start")}return(u,p)=>(b(),C(t(S),{justify:"center"},{default:a(()=>[s(t(ne),{value:e.value,"onUpdate:value":p[0]||(p[0]=r=>e.value=r),filterable:"",options:l,size:"large"},null,8,["value"]),s(t(w),{type:"primary",size:"large",onClick:n},{default:a(()=>p[2]||(p[2]=[f("开始猜测")])),_:1,__:[2]}),s(t(w),{secondary:"",size:"large",onClick:p[1]||(p[1]=r=>u.$emit("back"))},{default:a(()=>p[3]||(p[3]=[f(" 返回 ")])),_:1,__:[3]})]),_:1}))}},ge=M(ve,[["__scopeId","data-v-f87bb1ac"]]),_e={__name:"InputOp",emits:["select"],setup(c,{emit:o}){const d=o,e=k(""),l=k([]),n=x(()=>l.value.map(r=>({label:r,value:r})));async function u(){if(!e.value){l.value=[];return}l.value=await ye(e.value)}function p(r){d("select",r),e.value="",l.value=[]}return(r,y)=>(b(),C(t(re),{value:e.value,"onUpdate:value":[y[0]||(y[0]=i=>e.value=i),u],options:n.value,placeholder:"输入干员名称...",onSelect:p,"clear-after-select":"",style:{width:"300px"},size:"large"},null,8,["value","options"]))}},Q=M(_e,[["__scopeId","data-v-929ba567"]]),ke={__name:"GuessTable",props:{guesses:Array,showComparisonOnly:Boolean},setup(c){const o=c,d=[{key:"name",title:"姓名"},{key:"role",title:"职业"},{key:"rarity",title:"星级"},{key:"gender",title:"性别"},{key:"faction",title:"阵营"},{key:"position",title:"站位"},{key:"race",title:"种族"},{key:"release",title:"实装时间"}],e=x(()=>{const r=[];for(let y=0;y<d.length;y++){const i=d[y],g={title:i.title,key:i.key,align:"center",render:m=>{const _=m[i.key];return Z("span",[_.value," ",_.msg])},cellProps:m=>({style:{backgroundColor:m[i.key].bgColor}})};r.push(g)}return r});function l(r,y){const[i,g,m]=["#c8e6c9","#ffcdd2","#fff9c4"],_={equal:[i,"✓"],different:[g,"×"],close:[m,"○"],"too high":[g,"⇊"],"too low":[g,"⇈"],"too late":[g,"⇇"],"too soon":[g,"⇉"],"close high":[m,"↓"],"close low":[m,"↑"],"close late":[m,"←"],"close soon":[m,"→"]},[$,O]=_[y]||["#e0e0e0","❔"];return{value:r,msg:O,bgColor:$}}const n=x(()=>{const r=[];for(let y=0;y<o.guesses.length;y++){const i=o.guesses[y],g=i.guess,m=i.comparison,_={};for(let $=0;$<d.length;$++){const O=d[$];let R="";!o.showComparisonOnly&&g&&(O.key==="release"&&g.release?R=g.release.slice(2,10):R=g[O.key]||"");const v=m[O.key];_[O.key]=l(R,v)}r.push(_)}return r}),u=k(window.innerWidth);x(()=>u.value<=480?320:u.value<=768?375:800);function p(){u.value=window.innerWidth}return ee(()=>{window.addEventListener("resize",p)}),U(()=>{window.removeEventListener("resize",p)}),(r,y)=>(b(),C(t(ue),{columns:e.value,data:n.value,bordered:!0,size:"small",class:"guess-table"},{empty:a(()=>[s(t(le),{style:{color:"#c2c2c2"}},{default:a(()=>y[0]||(y[0]=[f("猜测记录")])),_:1,__:[0]})]),_:1},8,["columns","data"]))}},T=M(ke,[["__scopeId","data-v-034576eb"]]),be={__name:"GameScreen",props:["rarity"],emits:["back"],setup(c){const o=k([]),d=c,e=A();async function l(p){const r=await me(p);if(r.error)return alert(r.error);o.value.push(r),r.correct&&e.success("猜对了！")}async function n(){o.value=[],await K(d.rarity),e.info("已按当前稀有度重新设置谜底干员")}function u(){return d.rarity===0?"任意":d.rarity}return(p,r)=>(b(),z(h,null,[s(t(S),{size:"small",justify:"center"},{default:a(()=>[s(Q,{onSelect:l}),s(t(w),{type:"primary",size:"large",onClick:n},{default:a(()=>r[1]||(r[1]=[f("重新开始")])),_:1,__:[1]}),s(t(w),{secondary:"",size:"large",onClick:r[0]||(r[0]=y=>p.$emit("back"))},{default:a(()=>r[2]||(r[2]=[f("返回")])),_:1,__:[2]})]),_:1}),s(t(S),{vertical:"",align:"center"},{default:a(()=>[s(t(j),{bordered:!1},{footer:a(()=>[s(t(H),{placement:"bottom-start",trigger:"hover"},{trigger:a(()=>[s(t(w),{size:"large"},{default:a(()=>r[3]||(r[3]=[f("一些提示")])),_:1,__:[3]})]),default:a(()=>[s(t(S),{vertical:""},{default:a(()=>[s(t(N),null,{default:a(()=>r[4]||(r[4]=[f("红/黄/绿：错误/接近/正确")])),_:1,__:[4]}),s(t(N),null,{default:a(()=>r[5]||(r[5]=[f("→/↑代表谜底干员的时间更晚/星级更高")])),_:1,__:[5]}),s(t(N),null,{default:a(()=>[f("当前星级："+B(u()),1)]),_:1})]),_:1})]),_:1})]),default:a(()=>[s(T,{guesses:o.value},null,8,["guesses"])]),_:1})]),_:1})],64))}},Se=M(be,[["__scopeId","data-v-f654735b"]]),we={__name:"SinglePlayerStart",emits:["back"],setup(c,{emit:o}){const d=o,e=k("start"),l=k(0);function n(p){l.value=p}function u(){d("back")}return(p,r)=>(b(),C(t(V),null,{default:a(()=>[s(t(S),{vertical:"",align:"center",style:{padding:"32px"}},{default:a(()=>[s(t(E),null,{default:a(()=>r[2]||(r[2]=[f("单人模式")])),_:1,__:[2]}),e.value==="start"?(b(),C(ge,{key:0,onStart:r[0]||(r[0]=y=>e.value="game"),onRarity:n,onBack:u})):(b(),C(Se,{key:1,onBack:r[1]||(r[1]=y=>e.value="start"),rarity:l.value},null,8,["rarity"]))]),_:1})]),_:1}))}},L=te("websocket",()=>{let c=null,o=!1;const d=k(crypto.randomUUID()),e=k(""),l=k(!1),n=k({ready:!1,gameStarted:0,opponentJoined:!1,opponentReady:!1}),u=k(""),p=k(""),r=k(!1),y=k([]),i=k([]),g=k([]),m=k([]),_={onOpen:()=>console.log("Connected to server."),onMessage:v=>{console.log("Received message:",v.type);const I=v.userId===d.value;switch(v.type){case"broadcast":switch(v.data.message){case"join":if(n.value.gameStarted=0,n.value.opponentJoined=!0,n.value.opponentReady=!1,n.value.ready=!1,I){e.value=v.data.roomId,l.value=!0;break}else{p.value="对手已加入房间";break}case"ready":I?n.value.ready=!0:(n.value.opponentReady=!0,p.value="对手已准备");break;case"unready":I?n.value.ready=!1:(n.value.opponentReady=!1,p.value="对手取消准备");break;case"start":n.value.gameStarted=1;break;case"win":n.value.gameStarted=2,n.value.opponentJoined=!0,n.value.opponentReady=!1,n.value.ready=!1,p.value=I?"你赢了🎉":"你输了🥲";break;case"disconnect":n.value.gameStarted=2,n.value.opponentJoined=!1,n.value.opponentReady=!1,n.value.ready=!1,u.value="对手已断开连接";break}break;case"error":switch(v.data.message){case"opponent not yet joined":n.value.ready=!1;break;case"no available public room":R(),r.value=!0;break;default:R(),u.value=`错误: ${v.data.message}`;break}break;case"roomId":e.value=v.data.payload,l.value=!0,n.value.gameStarted=0,n.value.opponentJoined=!1,n.value.opponentReady=!1,n.value.ready=!1;break;case"self guess":v.data.payload.guess.release=new Date(v.data.payload.guess.release).toISOString(),y.value.push(v.data.payload);break;case"opponent guess":i.value.push(v.data.payload);break;case"opponent history":v.data.payload.forEach(P=>{P.release=new Date(P.release).toISOString()}),g.value=v.data.payload;break;case"suggest":m.value=v.data.payload;break;default:console.warn("Unknown message type:",v.type)}},onClose:()=>{l.value=!1,n.value.gameStarted=2,n.value.opponentJoined=!1,n.value.opponentReady=!1,n.value.ready=!1,y.value=[],i.value=[],g.value=[],console.log("WebSocket closed.")},onError:v=>{console.error("WebSocket error:",v)}};async function $(v=d.value,I={}){return o&&c?.readyState===WebSocket.OPEN?Promise.reject(new Error("WebSocket is already connected")):(d.value=v,Object.assign(_,I),new Promise((P,J)=>{c=new WebSocket("/multiplayer"),c.onopen=()=>{o=!0,_.onOpen(),P()},c.onmessage=G=>{const Y=JSON.parse(G.data);_.onMessage(Y)},c.onclose=()=>{o=!1,_.onClose()},c.onerror=G=>{o=!1,_.onError(G),J(G)}}))}async function O(v,I={}){return new Promise((P,J)=>{c&&c.readyState===WebSocket.OPEN?(c.send(JSON.stringify({type:v,userId:d.value,data:I})),P()):J(new Error("WebSocket is not connected"))})}async function R(){return new Promise(v=>{c&&o&&(c.onclose=()=>{o=!1,_.onClose()},c.close()),v()})}return{currentUserId:d,roomId:e,inRoom:l,roomStat:n,selfGuesses:y,opponentCmp:i,opponentOp:g,suggestions:m,errorMsg:u,infoMsg:p,findPublicFailed:r,connect:$,sendMessage:O,close:R}}),Ce={class:"table-wrapper"},Ne={class:"table-wrapper"},$e={__name:"MultiTable",setup(c){const o=L(),d=x(()=>l()),e=k(!0);function l(){if(o.opponentOp.length===0)return o.opponentCmp;{e.value=!1;let n=[];for(let u=0;u<o.opponentOp.length;u++)n.push({guess:o.opponentOp[u],comparison:o.opponentCmp[u].comparison});return n}}return(n,u)=>(b(),C(t(S),{vertical:""},{default:a(()=>[s(t(S),{class:"guess-tables-flex",wrap:!1},{default:a(()=>[F("div",Ce,[s(t(j),{size:"small",bordered:!1},{header:a(()=>[s(t(N),{strong:""},{default:a(()=>u[0]||(u[0]=[f("我的猜测")])),_:1,__:[0]})]),footer:a(()=>u[1]||(u[1]=[])),default:a(()=>[s(T,{guesses:t(o).selfGuesses,"show-comparison-only":!1},null,8,["guesses"])]),_:1})]),F("div",Ne,[s(t(j),{size:"small",bordered:!1},{header:a(()=>[s(t(N),{strong:""},{default:a(()=>u[2]||(u[2]=[f("对手猜测")])),_:1,__:[2]})]),default:a(()=>[s(T,{guesses:d.value,"show-comparison-only":e.value},null,8,["guesses","show-comparison-only"])]),_:1})])]),_:1}),s(t(S),{style:{transform:"translateX(15px)"}},{default:a(()=>[s(t(H),{placement:"bottom-start",trigger:"hover"},{trigger:a(()=>[s(t(w),{size:"large"},{default:a(()=>u[3]||(u[3]=[f("一些提示")])),_:1,__:[3]})]),default:a(()=>[s(t(S),{vertical:""},{default:a(()=>[s(t(N),null,{default:a(()=>u[4]||(u[4]=[f("红/黄/绿：错误/接近/正确；")])),_:1,__:[4]}),s(t(N),null,{default:a(()=>u[5]||(u[5]=[f("→/↑代表谜底干员的时间更晚/星级更高")])),_:1,__:[5]})]),_:1})]),_:1})]),_:1})]),_:1}))}},Oe=M($e,[["__scopeId","data-v-d384cd11"]]),Ie={key:0,style:{"text-align":"center"}},ze={key:0},xe={key:1,style:{"text-align":"center","margin-top":"16px"}},Me={__name:"GameRoom",emits:["back"],setup(c,{emit:o}){const d=A(),e=L();W(()=>e.roomStat.gameStarted,(m,_)=>{m===1&&_!==1&&d.success("游戏开始！")}),W(()=>e.errorMsg,m=>{m&&(d.error(m),e.errorMsg="")}),W(()=>e.infoMsg,m=>{m&&(d.info(m),e.infoMsg="")});const l=x(()=>e.roomStat.ready?"取消准备":"准备"),n=x(()=>e.roomStat.ready?"tertiary":"primary"),u=x(()=>e.roomStat.opponentJoined?e.roomStat.opponentReady?"已准备":"未准备":"未加入"),p=k(""),r=k([]);async function y(){e.roomStat.ready?await e.sendMessage("unready"):await e.sendMessage("ready")}async function i(m){await e.sendMessage("guess",{guess:m}),p.value="",r.value=[]}function g(){e.roomStat.ready=!1,e.roomStat.gameStarted=0,e.selfGuesses=[],e.opponentOp=[],e.opponentCmp=[]}return U(async()=>{await e.close()}),(m,_)=>(b(),z(h,null,[s(t(S),{vertical:"",align:"center",style:{padding:"32px"}},{default:a(()=>[s(t(E),null,{default:a(()=>[f("房间："+B(t(e).roomId),1)]),_:1}),s(t(S),{align:"center"},{default:a(()=>[t(e).roomStat.gameStarted===1?(b(),z("div",Ie,[s(Q,{onSelect:i})])):(b(),C(t(N),{key:1},{default:a(()=>[f("对手状态："+B(u.value),1)]),_:1})),s(t(w),{secondary:"",size:"large",onClick:_[0]||(_[0]=$=>{m.$emit("back")})},{default:a(()=>_[1]||(_[1]=[f("返回")])),_:1,__:[1]})]),_:1})]),_:1}),t(e).roomStat.gameStarted===1||t(e).roomStat.gameStarted===2?(b(),z("div",ze,[s(t(S),{justify:"center"},{default:a(()=>[s(Oe),t(e).roomStat.gameStarted===2?(b(),C(t(w),{key:0,onClick:g,secondary:"",size:"large"},{default:a(()=>_[2]||(_[2]=[f(" 关闭表格 ")])),_:1,__:[2]})):q("",!0)]),_:1})])):(b(),z("div",xe,[s(t(w),{onClick:y,type:n.value,disabled:!t(e).roomStat.opponentJoined,round:"",secondary:"",size:"large"},{default:a(()=>[f(B(l.value),1)]),_:1},8,["type","disabled"])]))],64))}},Re=M(Me,[["__scopeId","data-v-ed0ae645"]]),Pe={__name:"MultiPlayerStart",emits:["back"],setup(c){const o=L(),d=A(),e=k(""),l=k(!0);async function n(){await o.connect(),await o.sendMessage("create",{public:l.value})}async function u(){await o.connect(),await o.sendMessage("join",{roomId:e.value})}async function p(){await o.connect(),await o.sendMessage("find")}W(()=>o.findPublicFailed,y=>{y&&(o.findPublicFailed=!1,d.error("没有可用的公共房间，请稍后再试"))});function r(){ae(()=>{o.inRoom=!1})}return U(async()=>{await o.close()}),(y,i)=>t(o).inRoom?(b(),C(Re,{key:0,onBack:r})):(b(),C(t(S),{key:1,vertical:"",align:"center",style:{padding:"32px"}},{default:a(()=>[s(t(E),{style:{"text-align":"center"}},{default:a(()=>i[3]||(i[3]=[f("双人模式")])),_:1,__:[3]}),s(t(S),{justify:"center",size:10},{default:a(()=>[s(t(w),{type:"primary",size:"large",onClick:p},{default:a(()=>i[4]||(i[4]=[f("寻找公共房间")])),_:1,__:[4]}),s(t(w),{secondary:"",size:"large",onClick:i[0]||(i[0]=g=>y.$emit("back"))},{default:a(()=>i[5]||(i[5]=[f("返回")])),_:1,__:[5]})]),_:1}),s(t(j),null,{default:a(()=>[s(t(S),{justify:"center",size:5},{default:a(()=>[s(t(ie),{value:e.value,"onUpdate:value":i[1]||(i[1]=g=>e.value=g),placeholder:"输入房间号",style:{width:"120px"}},null,8,["value"]),s(t(w),{type:"primary",size:"large",onClick:u},{default:a(()=>i[6]||(i[6]=[f("加入房间")])),_:1,__:[6]})]),_:1})]),_:1}),s(t(j),{size:"small"},{default:a(()=>[s(t(de),{checked:l.value,"onUpdate:checked":i[2]||(i[2]=g=>l.value=g),size:"large"},{default:a(()=>i[7]||(i[7]=[f("公共游戏")])),_:1,__:[7]},8,["checked"]),s(t(w),{type:"primary",size:"large",onClick:n},{default:a(()=>i[8]||(i[8]=[f("创建房间")])),_:1,__:[8]})]),_:1})]),_:1}))}},je=M(Pe,[["__scopeId","data-v-fdfe50dc"]]),Ge={key:0},Be={key:1},We={key:2},Ee={__name:"App",setup(c){const o=k("choose");return(d,e)=>(b(),C(t(fe),null,{default:a(()=>[s(t(ce)),s(t(V),null,{default:a(()=>[o.value==="choose"?(b(),z("div",Ge,[s(t(S),{vertical:"",align:"center",style:{padding:"32px"}},{default:a(()=>[s(t(E),null,{default:a(()=>e[4]||(e[4]=[f("猜干员 - 明日方舟")])),_:1,__:[4]}),s(t(w),{type:"primary",size:"large",onClick:e[0]||(e[0]=l=>o.value="single"),class:"big-button"},{default:a(()=>e[5]||(e[5]=[f(" 单人模式 ")])),_:1,__:[5]}),s(t(w),{type:"primary",size:"large",onClick:e[1]||(e[1]=l=>o.value="multi"),class:"big-button"},{default:a(()=>e[6]||(e[6]=[f(" 双人模式 ")])),_:1,__:[6]}),s(t(S),null,{default:a(()=>[s(t(N),{depth:"3",style:{"font-size":"12px"}},{default:a(()=>e[7]||(e[7]=[f("作者：SNINMNON")])),_:1,__:[7]}),s(t(pe),{href:"https://github.com/SNINMNON/OperatorGuessing",style:{"font-size":"12px"}},{default:a(()=>e[8]||(e[8]=[f("Github 仓库 ")])),_:1,__:[8]})]),_:1})]),_:1})])):o.value==="single"?(b(),z("div",Be,[s(we,{onBack:e[2]||(e[2]=l=>o.value="choose")})])):o.value==="multi"?(b(),z("div",We,[s(je,{onBack:e[3]||(e[3]=l=>o.value="choose")})])):q("",!0)]),_:1})]),_:1}))}},Je=M(Ee,[["__scopeId","data-v-fa8f8a29"]]),Te=se(),X=oe(Je);X.use(Te);X.mount("#app");
