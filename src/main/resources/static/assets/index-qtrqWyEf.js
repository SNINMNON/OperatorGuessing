import{r as v,H as C,I as k,J as a,K as s,L as t,j as y,c as z,m as ee,o as te,G as h,M as O,N as T,F as q,O as ae,P as F,w as W,Q as H,n as se,R as ne,S as oe}from"./vue-vendor-CfuPwfJT.js";import{N as le,B as w,a as b,b as re,c as ue,d as ie,u as A,e as G,f as V,g as N,h as E,i as K,j as de,k as ce,l as pe,m as fe,n as ye}from"./naive-ui-Bo9_qUcw.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&e(u)}).observe(document,{childList:!0,subtree:!0});function d(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(r){if(r.ep)return;r.ep=!0;const o=d(r);fetch(r.href,o)}})();const D="/api";async function Q(c){return await(await fetch(`${D}/start?rarity=${c}`,{credentials:"include"})).json()}async function me(c){return await(await fetch(`${D}/suggest?query=${encodeURIComponent(c)}`,{credentials:"include"})).json()}async function ve(c){return await(await fetch(`${D}/guess?name=${encodeURIComponent(c)}`,{method:"POST",credentials:"include"})).json()}const x=(c,n)=>{const d=c.__vccOpts||c;for(const[e,r]of n)d[e]=r;return d},ge={__name:"StartScreen",emits:["start","rarity","back"],setup(c,{emit:n}){const d=n,e=v(0),r=[{label:"任意星级",value:0},...Array.from({length:6},(u,p)=>({label:`${p+1}星`,value:p+1}))];async function o(){await Q(e.value),d("rarity",e.value),d("start")}return(u,p)=>(k(),C(t(b),{justify:"center",size:"small"},{default:a(()=>[s(t(le),{value:e.value,"onUpdate:value":p[0]||(p[0]=l=>e.value=l),filterable:"",options:r,size:"large"},null,8,["value"]),s(t(w),{type:"primary",size:"large",onClick:o},{default:a(()=>p[2]||(p[2]=[y("开始猜测")])),_:1,__:[2]}),s(t(w),{secondary:"",size:"large",onClick:p[1]||(p[1]=l=>u.$emit("back"))},{default:a(()=>p[3]||(p[3]=[y(" 返回 ")])),_:1,__:[3]})]),_:1}))}},_e=x(ge,[["__scopeId","data-v-d1b0a6f9"]]),ke={__name:"InputOp",emits:["select"],setup(c,{emit:n}){const d=n,e=v(""),r=v([]),o=z(()=>r.value.map(l=>({label:l,value:l})));async function u(){if(!e.value){r.value=[];return}r.value=await me(e.value)}function p(l){d("select",l),e.value="",r.value=[]}return(l,m)=>(k(),C(t(re),{value:e.value,"onUpdate:value":[m[0]||(m[0]=i=>e.value=i),u],options:o.value,placeholder:"输入干员名称...",onSelect:p,"clear-after-select":"",style:{width:"300px"},size:"large"},null,8,["value","options"]))}},X=x(ke,[["__scopeId","data-v-6ba31026"]]),be={__name:"GuessTable",props:{guesses:Array,showComparisonOnly:Boolean},setup(c){const n=c,d=[{key:"name",title:"姓名"},{key:"role",title:"职业"},{key:"rarity",title:"星级"},{key:"gender",title:"性别"},{key:"faction",title:"阵营"},{key:"position",title:"站位"},{key:"race",title:"种族"},{key:"release",title:"实装时间"}],e=z(()=>{const l=[];for(let m=0;m<d.length;m++){const i=d[m],f={title:i.title,key:i.key,align:"center",render:g=>{const S=g[i.key];return ee("span",[S.value," ",S.msg])},cellProps:g=>({style:{backgroundColor:g[i.key].bgColor}})};l.push(f)}return l});function r(l,m){const[i,f,g]=["#c8e6c9","#ffcdd2","#fff9c4"],S={equal:[i,"✓"],different:[f,"×"],close:[g,"○"],"too high":[f,"⇊"],"too low":[f,"⇈"],"too late":[f,"⇇"],"too soon":[f,"⇉"],"close high":[g,"↓"],"close low":[g,"↑"],"close late":[g,"←"],"close soon":[g,"→"]},[M,$]=S[m]||["#e0e0e0","❔"];return{value:l,msg:$,bgColor:M}}const o=z(()=>{const l=[];for(let m=0;m<n.guesses.length;m++){const i=n.guesses[m],f=i.guess,g=i.comparison,S={};for(let M=0;M<d.length;M++){const $=d[M];let P="";!n.showComparisonOnly&&f&&($.key==="release"&&f.release?P=f.release.slice(2,10):P=f[$.key]||"");const j=g[$.key];S[$.key]=r(P,j)}l.push(S)}return l}),u=v(window.innerWidth);z(()=>u.value<=480?320:u.value<=768?375:800);function p(){u.value=window.innerWidth}return te(()=>{window.addEventListener("resize",p)}),h(()=>{window.removeEventListener("resize",p)}),(l,m)=>(k(),C(t(ie),{columns:e.value,data:o.value,bordered:!0,size:"small",class:"guess-table"},{empty:a(()=>[s(t(ue),{style:{color:"#c2c2c2"}},{default:a(()=>m[0]||(m[0]=[y("猜测记录")])),_:1,__:[0]})]),_:1},8,["columns","data"]))}},U=x(be,[["__scopeId","data-v-034576eb"]]),Se={__name:"GameScreen",props:["rarity"],emits:["back"],setup(c){const n=v([]),d=c,e=A();async function r(p){const l=await ve(p);if(l.error)return alert(l.error);n.value.push(l),l.correct&&e.success("猜对了！")}async function o(){n.value=[],await Q(d.rarity),e.info("已按当前稀有度重新设置谜底干员")}function u(){return d.rarity===0?"任意":d.rarity}return(p,l)=>(k(),O(q,null,[s(t(b),{class:"game-button-flex",size:"small",justify:"center",align:"center"},{default:a(()=>[s(X,{onSelect:r}),s(t(b),{size:"small",justify:"center",align:"center"},{default:a(()=>[s(t(w),{type:"primary",size:"large",onClick:o},{default:a(()=>l[1]||(l[1]=[y("重新开始")])),_:1,__:[1]}),s(t(w),{secondary:"",size:"large",onClick:l[0]||(l[0]=m=>p.$emit("back"))},{default:a(()=>l[2]||(l[2]=[y("返回")])),_:1,__:[2]})]),_:1})]),_:1}),s(t(b),{vertical:"",align:"center"},{default:a(()=>[s(t(G),{bordered:!1},{footer:a(()=>[s(t(V),{placement:"bottom-start",trigger:"hover"},{trigger:a(()=>[s(t(w),{size:"large"},{default:a(()=>l[3]||(l[3]=[y("一些提示")])),_:1,__:[3]})]),default:a(()=>[s(t(b),{vertical:""},{default:a(()=>[s(t(N),null,{default:a(()=>l[4]||(l[4]=[y("红/黄/绿：错误/接近/正确")])),_:1,__:[4]}),s(t(N),null,{default:a(()=>l[5]||(l[5]=[y("→/↑代表谜底干员的时间更晚/星级更高")])),_:1,__:[5]}),s(t(N),null,{default:a(()=>[y("当前星级："+T(u()),1)]),_:1})]),_:1})]),_:1})]),default:a(()=>[s(U,{guesses:n.value},null,8,["guesses"])]),_:1})]),_:1})],64))}},we=x(Se,[["__scopeId","data-v-3c20f546"]]),Ce={__name:"SinglePlayerStart",emits:["back"],setup(c,{emit:n}){const d=n,e=v("start"),r=v(0);function o(p){r.value=p}function u(){d("back")}return(p,l)=>(k(),C(t(K),null,{default:a(()=>[s(t(b),{vertical:"",align:"center",style:{padding:"32px"}},{default:a(()=>[s(t(E),null,{default:a(()=>l[2]||(l[2]=[y("单人模式")])),_:1,__:[2]}),e.value==="start"?(k(),C(_e,{key:0,onStart:l[0]||(l[0]=m=>e.value="game"),onRarity:o,onBack:u})):(k(),C(we,{key:1,onBack:l[1]||(l[1]=m=>e.value="start"),rarity:r.value},null,8,["rarity"]))]),_:1})]),_:1}))}},L=ae("websocket",()=>{let c=null,n=!1;const d=v(crypto.randomUUID()),e=v(""),r=v(!1),o=v({ready:!1,gameStarted:0,opponentJoined:!1,opponentReady:!1}),u=v(""),p=v(""),l=v(!1),m=v([]),i=v([]),f=v([]),g=v([]),S={onOpen:()=>console.log("Connected to server."),onMessage:_=>{const I=_.userId===d.value;switch(_.type){case"broadcast":switch(_.data.message){case"join":if(o.value.opponentJoined=!0,o.value.opponentReady=!1,j(),I){e.value=_.data.roomId,r.value=!0;break}else{p.value="对手已加入房间";break}case"ready":I?o.value.ready=!0:(o.value.opponentReady=!0,p.value="对手已准备");break;case"unready":I?o.value.ready=!1:(o.value.opponentReady=!1,p.value="对手取消准备");break;case"start":o.value.gameStarted=1;break;case"win":o.value.gameStarted=2,o.value.opponentJoined=!0,o.value.opponentReady=!1,o.value.ready=!1,p.value=I?"你赢了🎉":"你输了🥲";break;case"disconnect":o.value.gameStarted=2,o.value.opponentJoined=!1,o.value.opponentReady=!1,o.value.ready=!1,u.value="对手已断开连接";break}break;case"error":switch(_.data.message){case"opponent not yet joined":o.value.ready=!1;break;case"no available public room":P(),l.value=!0;break;default:P(),u.value=`错误: ${_.data.message}`;break}break;case"roomId":e.value=_.data.payload,r.value=!0,o.value.gameStarted=0,o.value.opponentJoined=!1,o.value.opponentReady=!1,o.value.ready=!1;break;case"self guess":_.data.payload.guess.release=new Date(_.data.payload.guess.release).toISOString(),m.value.push(_.data.payload);break;case"opponent guess":i.value.push(_.data.payload);break;case"opponent history":_.data.payload.forEach(R=>{R.release=new Date(R.release).toISOString()}),f.value=_.data.payload;break;case"suggest":g.value=_.data.payload;break;default:console.warn("Unknown message type:",_.type)}},onClose:()=>{r.value=!1,o.value.opponentJoined=!1,o.value.opponentReady=!1,j(),o.value.gameStarted=2,console.log("WebSocket closed.")},onError:_=>{console.error("WebSocket error:",_)}};async function M(_=d.value,I={}){return n&&c?.readyState===WebSocket.OPEN?Promise.reject(new Error("WebSocket is already connected")):(d.value=_,Object.assign(S,I),new Promise((R,J)=>{c=new WebSocket("/multiplayer"),c.onopen=()=>{n=!0,S.onOpen(),R()},c.onmessage=B=>{const Z=JSON.parse(B.data);S.onMessage(Z)},c.onclose=()=>{n=!1,S.onClose()},c.onerror=B=>{n=!1,S.onError(B),J(B)}}))}async function $(_,I={}){return new Promise((R,J)=>{c&&c.readyState===WebSocket.OPEN?(c.send(JSON.stringify({type:_,userId:d.value,data:I})),R()):J(new Error("WebSocket is not connected"))})}async function P(){return new Promise(_=>{c&&n&&(c.onclose=()=>{n=!1,S.onClose()},c.close()),_()})}function j(){o.value.ready=!1,o.value.gameStarted=0,m.value=[],i.value=[],f.value=[]}return{currentUserId:d,roomId:e,inRoom:r,roomStat:o,selfGuesses:m,opponentCmp:i,opponentOp:f,suggestions:g,errorMsg:u,infoMsg:p,findPublicFailed:l,connect:M,sendMessage:$,close:P,resetTable:j}}),Ne={class:"table-wrapper"},$e={class:"table-wrapper"},Ie={__name:"MultiTable",setup(c){const n=L(),d=z(()=>r()),e=v(!0);function r(){if(n.opponentOp.length===0)return n.opponentCmp;{e.value=!1;let o=[];for(let u=0;u<n.opponentOp.length;u++)o.push({guess:n.opponentOp[u],comparison:n.opponentCmp[u].comparison});return o}}return(o,u)=>(k(),C(t(b),{vertical:""},{default:a(()=>[s(t(b),{class:"guess-tables-flex",wrap:!1},{default:a(()=>[F("div",Ne,[s(t(G),{size:"small",bordered:!1,"header-style":"padding: 0px"},{header:a(()=>[s(t(N),{strong:"",class:"small-header"},{default:a(()=>u[0]||(u[0]=[y("我的猜测")])),_:1,__:[0]})]),footer:a(()=>u[1]||(u[1]=[])),default:a(()=>[s(U,{guesses:t(n).selfGuesses,"show-comparison-only":!1},null,8,["guesses"])]),_:1})]),F("div",$e,[s(t(G),{size:"small",bordered:!1,"header-style":"padding: 0px"},{header:a(()=>[s(t(N),{strong:"",class:"small-header"},{default:a(()=>u[2]||(u[2]=[y("对手猜测")])),_:1,__:[2]})]),default:a(()=>[s(U,{guesses:d.value,"show-comparison-only":e.value},null,8,["guesses","show-comparison-only"])]),_:1})])]),_:1}),s(t(b),{style:{transform:"translateX(15px)"}},{default:a(()=>[s(t(V),{placement:"bottom-start",trigger:"hover"},{trigger:a(()=>[s(t(w),{size:"large"},{default:a(()=>u[3]||(u[3]=[y("一些提示")])),_:1,__:[3]})]),default:a(()=>[s(t(b),{vertical:""},{default:a(()=>[s(t(N),null,{default:a(()=>u[4]||(u[4]=[y("红/黄/绿：错误/接近/正确；")])),_:1,__:[4]}),s(t(N),null,{default:a(()=>u[5]||(u[5]=[y("→/↑代表谜底干员的时间更晚/星级更高")])),_:1,__:[5]})]),_:1})]),_:1})]),_:1})]),_:1}))}},Oe=x(Ie,[["__scopeId","data-v-c9d0212f"]]),ze={key:0,style:{"text-align":"center"}},xe={key:0},Me={key:1,style:{"text-align":"center","margin-top":"16px"}},Pe={__name:"GameRoom",emits:["back"],setup(c,{emit:n}){const d=A(),e=L();W(()=>e.roomStat.gameStarted,(f,g)=>{f===1&&g!==1&&d.success("游戏开始！")}),W(()=>e.errorMsg,f=>{f&&(d.error(f),e.errorMsg="")}),W(()=>e.infoMsg,f=>{f&&(d.info(f),e.infoMsg="")});const r=z(()=>e.roomStat.ready?"取消准备":"准备"),o=z(()=>e.roomStat.ready?"tertiary":"primary"),u=z(()=>e.roomStat.opponentJoined?e.roomStat.opponentReady?"已准备":"未准备":"未加入"),p=v(""),l=v([]);async function m(){e.roomStat.ready?await e.sendMessage("unready"):await e.sendMessage("ready")}async function i(f){await e.sendMessage("guess",{guess:f}),p.value="",l.value=[]}return h(async()=>{await e.close()}),(f,g)=>(k(),O(q,null,[s(t(b),{vertical:"",align:"center",style:{padding:"32px"}},{default:a(()=>[s(t(E),null,{default:a(()=>[y("房间："+T(t(e).roomId),1)]),_:1}),s(t(b),{align:"center"},{default:a(()=>[t(e).roomStat.gameStarted===1?(k(),O("div",ze,[s(X,{onSelect:i})])):(k(),C(t(N),{key:1},{default:a(()=>[y("对手状态："+T(u.value),1)]),_:1})),s(t(w),{secondary:"",size:"large",onClick:g[0]||(g[0]=S=>{t(e).resetTable,f.$emit("back")})},{default:a(()=>g[1]||(g[1]=[y("返回")])),_:1,__:[1]})]),_:1})]),_:1}),t(e).roomStat.gameStarted===1||t(e).roomStat.gameStarted===2?(k(),O("div",xe,[s(t(b),{justify:"center"},{default:a(()=>[s(Oe),t(e).roomStat.gameStarted===2?(k(),C(t(w),{key:0,onClick:t(e).resetTable,secondary:"",size:"large"},{default:a(()=>g[2]||(g[2]=[y(" 关闭表格 ")])),_:1,__:[2]},8,["onClick"])):H("",!0)]),_:1})])):(k(),O("div",Me,[s(t(w),{onClick:m,type:o.value,disabled:!t(e).roomStat.opponentJoined,round:"",secondary:"",size:"large"},{default:a(()=>[y(T(r.value),1)]),_:1},8,["type","disabled"])]))],64))}},Re=x(Pe,[["__scopeId","data-v-bd84b810"]]),je={__name:"MultiPlayerStart",emits:["back"],setup(c){const n=L(),d=A(),e=v(""),r=v(!0);async function o(){await n.connect(),await n.sendMessage("create",{public:r.value})}async function u(){await n.connect(),await n.sendMessage("join",{roomId:e.value})}async function p(){await n.connect(),await n.sendMessage("find")}W(()=>n.findPublicFailed,m=>{m&&(n.findPublicFailed=!1,d.error("没有可用的公共房间，请稍后再试"))});function l(){se(()=>{n.inRoom=!1})}return h(async()=>{await n.close()}),(m,i)=>t(n).inRoom?(k(),C(Re,{key:0,onBack:l})):(k(),C(t(b),{key:1,vertical:"",align:"center",style:{padding:"32px"}},{default:a(()=>[s(t(E),{style:{"text-align":"center"}},{default:a(()=>i[3]||(i[3]=[y("双人模式")])),_:1,__:[3]}),s(t(b),{justify:"center",size:10},{default:a(()=>[s(t(w),{type:"primary",size:"large",onClick:p},{default:a(()=>i[4]||(i[4]=[y("寻找公共房间")])),_:1,__:[4]}),s(t(w),{secondary:"",size:"large",onClick:i[0]||(i[0]=f=>m.$emit("back"))},{default:a(()=>i[5]||(i[5]=[y("返回")])),_:1,__:[5]})]),_:1}),s(t(G),null,{default:a(()=>[s(t(b),{justify:"center",size:5},{default:a(()=>[s(t(de),{value:e.value,"onUpdate:value":i[1]||(i[1]=f=>e.value=f),placeholder:"输入房间号",style:{width:"120px"}},null,8,["value"]),s(t(w),{type:"primary",size:"large",onClick:u},{default:a(()=>i[6]||(i[6]=[y("加入房间")])),_:1,__:[6]})]),_:1})]),_:1}),s(t(G),{size:"small"},{default:a(()=>[s(t(ce),{checked:r.value,"onUpdate:checked":i[2]||(i[2]=f=>r.value=f),size:"large"},{default:a(()=>i[7]||(i[7]=[y("公共游戏")])),_:1,__:[7]},8,["checked"]),s(t(w),{type:"primary",size:"large",onClick:o},{default:a(()=>i[8]||(i[8]=[y("创建房间")])),_:1,__:[8]})]),_:1})]),_:1}))}},Ge=x(je,[["__scopeId","data-v-fdfe50dc"]]),Be={key:0},Te={key:1},We={key:2},Ee={__name:"App",setup(c){const n=v("choose");return(d,e)=>(k(),C(t(ye),null,{default:a(()=>[s(t(pe)),s(t(K),null,{default:a(()=>[n.value==="choose"?(k(),O("div",Be,[s(t(b),{vertical:"",align:"center",style:{padding:"32px"}},{default:a(()=>[s(t(E),null,{default:a(()=>e[4]||(e[4]=[y("猜干员 - 明日方舟")])),_:1,__:[4]}),s(t(w),{type:"primary",size:"large",onClick:e[0]||(e[0]=r=>n.value="single"),class:"big-button"},{default:a(()=>e[5]||(e[5]=[y(" 单人模式 ")])),_:1,__:[5]}),s(t(w),{type:"primary",size:"large",onClick:e[1]||(e[1]=r=>n.value="multi"),class:"big-button"},{default:a(()=>e[6]||(e[6]=[y(" 双人模式 ")])),_:1,__:[6]}),s(t(b),null,{default:a(()=>[s(t(N),{depth:"3",style:{"font-size":"12px"}},{default:a(()=>e[7]||(e[7]=[y("作者：SNINMNON")])),_:1,__:[7]}),s(t(fe),{href:"https://github.com/SNINMNON/OperatorGuessing",style:{"font-size":"12px"}},{default:a(()=>e[8]||(e[8]=[y("Github 仓库 ")])),_:1,__:[8]})]),_:1})]),_:1})])):n.value==="single"?(k(),O("div",Te,[s(Ce,{onBack:e[2]||(e[2]=r=>n.value="choose")})])):n.value==="multi"?(k(),O("div",We,[s(Ge,{onBack:e[3]||(e[3]=r=>n.value="choose")})])):H("",!0)]),_:1})]),_:1}))}},Je=x(Ee,[["__scopeId","data-v-039abad4"]]),Ue=ne(),Y=oe(Je);Y.use(Ue);Y.mount("#app");
