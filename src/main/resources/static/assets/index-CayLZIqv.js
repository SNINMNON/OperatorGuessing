import{r as _,H as C,I as b,J as a,K as s,L as t,j as f,c as I,m as h,o as ee,G as U,M as z,N as B,F as q,O as te,P as F,w as W,Q as H,n as ae,R as se,S as oe}from"./vue-vendor-CfuPwfJT.js";import{N as ne,B as w,a as S,b as le,c as re,d as ue,u as A,e as j,f as V,g as O,h as E,i as K,j as ie,k as de,l as ce,m as pe}from"./naive-ui-C3jCPKny.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))e(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function d(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerPolicy&&(n.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?n.credentials="include":l.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(l){if(l.ep)return;l.ep=!0;const n=d(l);fetch(l.href,n)}})();const L="/api";async function Q(c){return await(await fetch(`${L}/start?rarity=${c}`,{credentials:"include"})).json()}async function fe(c){return await(await fetch(`${L}/suggest?query=${encodeURIComponent(c)}`,{credentials:"include"})).json()}async function ye(c){return await(await fetch(`${L}/guess?name=${encodeURIComponent(c)}`,{method:"POST",credentials:"include"})).json()}const M=(c,o)=>{const d=c.__vccOpts||c;for(const[e,l]of o)d[e]=l;return d},me={__name:"StartScreen",emits:["start","rarity","back"],setup(c,{emit:o}){const d=o,e=_(0),l=[{label:"ä»»æ„æ˜Ÿçº§",value:0,style:"font-size: 16px;"},...Array.from({length:6},(r,p)=>({label:`${p+1}æ˜Ÿ`,value:p+1,style:"font-size: 16px;"}))];async function n(){await Q(e.value),d("rarity",e.value),d("start")}return(r,p)=>(b(),C(t(S),{justify:"center"},{default:a(()=>[s(t(ne),{value:e.value,"onUpdate:value":p[0]||(p[0]=i=>e.value=i),filterable:"",options:l,size:"large"},null,8,["value"]),s(t(w),{type:"primary",size:"large",onClick:n},{default:a(()=>p[2]||(p[2]=[f("å¼€å§‹çŒœæµ‹")])),_:1,__:[2]}),s(t(w),{secondary:"",size:"large",onClick:p[1]||(p[1]=i=>r.$emit("back"))},{default:a(()=>p[3]||(p[3]=[f(" è¿”å›ž ")])),_:1,__:[3]})]),_:1}))}},ve=M(me,[["__scopeId","data-v-adec7fe6"]]),ge={__name:"InputOp",emits:["select"],setup(c,{emit:o}){const d=o,e=_(""),l=_([]),n=y=>h("NText",{style:{fontSize:"16px"}},y.label),r=I(()=>l.value.map(y=>({label:y,value:y})));async function p(){if(!e.value){l.value=[];return}l.value=await fe(e.value)}function i(y){d("select",y),e.value="",l.value=[]}return(y,u)=>(b(),C(t(le),{value:e.value,"onUpdate:value":[u[0]||(u[0]=k=>e.value=k),p],options:r.value,placeholder:"è¾“å…¥å¹²å‘˜åç§°...",onSelect:i,"clear-after-select":"",style:{"max-width":"160px"},size:"large","render-label":n},null,8,["value","options"]))}},X=M(ge,[["__scopeId","data-v-1a5e2ce9"]]),_e={__name:"GuessTable",props:{guesses:Array,showComparisonOnly:Boolean},setup(c){const o=c,d=[{key:"name",title:"å§“å"},{key:"role",title:"èŒä¸š"},{key:"rarity",title:"æ˜Ÿçº§"},{key:"gender",title:"æ€§åˆ«"},{key:"faction",title:"é˜µè¥"},{key:"position",title:"ç«™ä½"},{key:"race",title:"ç§æ—"},{key:"release",title:"å®žè£…æ—¶é—´"}],e=I(()=>{const y=[];for(let u=0;u<d.length;u++){const k=d[u],v={title:k.title,key:k.key,align:"center",render:g=>{const N=g[k.key];return h("span",[N.value," ",N.msg])},cellProps:g=>({style:{backgroundColor:g[k.key].bgColor}})};y.push(v)}return y});function l(y,u){const[k,v,g]=["#c8e6c9","#ffcdd2","#fff9c4"],N={equal:[k,"âœ“"],different:[v,"Ã—"],close:[g,"â—‹"],"too high":[v,"â‡Š"],"too low":[v,"â‡ˆ"],"too late":[v,"â‡‡"],"too soon":[v,"â‡‰"],"close high":[g,"â†“"],"close low":[g,"â†‘"],"close late":[g,"â†"],"close soon":[g,"â†’"]},[R,$]=N[u]||["#e0e0e0","â”"];return{value:y,msg:$,bgColor:R}}const n=I(()=>{const y=[];for(let u=0;u<o.guesses.length;u++){const k=o.guesses[u],v=k.guess,g=k.comparison,N={};for(let R=0;R<d.length;R++){const $=d[R];let m="";!o.showComparisonOnly&&v&&($.key==="release"&&v.release?m=v.release.slice(2,10):m=v[$.key]||"");const x=g[$.key];N[$.key]=l(m,x)}y.push(N)}return y}),r=_(window.innerWidth),p=I(()=>r.value<=480?320:r.value<=768?400:800);function i(){r.value=window.innerWidth}return ee(()=>{window.addEventListener("resize",i)}),U(()=>{window.removeEventListener("resize",i)}),(y,u)=>(b(),C(t(ue),{columns:e.value,data:n.value,bordered:!0,size:"small","scroll-x":p.value,class:"guess-table"},{empty:a(()=>[s(t(re),{style:{color:"#c2c2c2"}},{default:a(()=>u[0]||(u[0]=[f("çŒœæµ‹è®°å½•")])),_:1,__:[0]})]),_:1},8,["columns","data","scroll-x"]))}},J=M(_e,[["__scopeId","data-v-69c9375f"]]),ke={__name:"GameScreen",props:["rarity"],emits:["back"],setup(c){const o=_([]),d=c,e=A();async function l(p){const i=await ye(p);if(i.error)return alert(i.error);o.value.push(i),i.correct&&e.success("çŒœå¯¹äº†ï¼")}async function n(){o.value=[],await Q(d.rarity),e.info("å·²æŒ‰å½“å‰ç¨€æœ‰åº¦é‡æ–°è®¾ç½®è°œåº•å¹²å‘˜")}function r(){return d.rarity===0?"ä»»æ„":d.rarity}return(p,i)=>(b(),z(q,null,[s(t(S),{size:"small"},{default:a(()=>[s(t(w),{type:"primary",size:"large",onClick:n},{default:a(()=>i[1]||(i[1]=[f("é‡æ–°å¼€å§‹")])),_:1,__:[1]}),s(X,{onSelect:l}),s(t(w),{secondary:"",size:"large",onClick:i[0]||(i[0]=y=>p.$emit("back"))},{default:a(()=>i[2]||(i[2]=[f("è¿”å›ž")])),_:1,__:[2]})]),_:1}),s(t(S),{vertical:"",align:"center"},{default:a(()=>[s(t(j),{bordered:!1},{footer:a(()=>[s(t(V),{placement:"bottom-start",trigger:"hover"},{trigger:a(()=>[s(t(w),{size:"large"},{default:a(()=>i[3]||(i[3]=[f("ä¸€äº›æç¤º")])),_:1,__:[3]})]),default:a(()=>[s(t(S),{vertical:""},{default:a(()=>[s(t(O),null,{default:a(()=>i[4]||(i[4]=[f("çº¢/é»„/ç»¿ï¼šé”™è¯¯/æŽ¥è¿‘/æ­£ç¡®")])),_:1,__:[4]}),s(t(O),null,{default:a(()=>i[5]||(i[5]=[f("â†’/â†‘ä»£è¡¨è°œåº•å¹²å‘˜çš„æ—¶é—´æ›´æ™š/æ˜Ÿçº§æ›´é«˜")])),_:1,__:[5]}),s(t(O),null,{default:a(()=>[f("å½“å‰æ˜Ÿçº§ï¼š"+B(r()),1)]),_:1})]),_:1})]),_:1})]),default:a(()=>[s(J,{guesses:o.value},null,8,["guesses"])]),_:1})]),_:1})],64))}},be=M(ke,[["__scopeId","data-v-ac6cdd58"]]),Se={__name:"SinglePlayerStart",emits:["back"],setup(c,{emit:o}){const d=o,e=_("start"),l=_(0);function n(p){l.value=p}function r(){d("back")}return(p,i)=>(b(),C(t(K),null,{default:a(()=>[s(t(S),{vertical:"",align:"center",style:{padding:"32px"}},{default:a(()=>[s(t(E),null,{default:a(()=>i[2]||(i[2]=[f("å•äººæ¨¡å¼")])),_:1,__:[2]}),e.value==="start"?(b(),C(ve,{key:0,onStart:i[0]||(i[0]=y=>e.value="game"),onRarity:n,onBack:r})):(b(),C(be,{key:1,onBack:i[1]||(i[1]=y=>e.value="start"),rarity:l.value},null,8,["rarity"]))]),_:1})]),_:1}))}},D=te("websocket",()=>{let c=null,o=!1;const d=_(crypto.randomUUID()),e=_(""),l=_(!1),n=_({ready:!1,gameStarted:0,opponentJoined:!1,opponentReady:!1}),r=_(""),p=_(""),i=_(!1),y=_([]),u=_([]),k=_([]),v=_([]),g={onOpen:()=>console.log("Connected to server."),onMessage:m=>{console.log("Received message:",m.type);const x=m.userId===d.value;switch(m.type){case"broadcast":switch(m.data.message){case"join":if(n.value.gameStarted=0,n.value.opponentJoined=!0,n.value.opponentReady=!1,n.value.ready=!1,x){e.value=m.data.roomId,l.value=!0;break}else{p.value="å¯¹æ‰‹å·²åŠ å…¥æˆ¿é—´";break}case"ready":x?n.value.ready=!0:(n.value.opponentReady=!0,p.value="å¯¹æ‰‹å·²å‡†å¤‡");break;case"unready":x?n.value.ready=!1:(n.value.opponentReady=!1,p.value="å¯¹æ‰‹å–æ¶ˆå‡†å¤‡");break;case"start":n.value.gameStarted=1;break;case"win":n.value.gameStarted=2,n.value.opponentJoined=!0,n.value.opponentReady=!1,n.value.ready=!1,p.value=x?"ä½ èµ¢äº†ðŸŽ‰":"ä½ è¾“äº†ðŸ¥²";break;case"disconnect":n.value.gameStarted=2,n.value.opponentJoined=!1,n.value.opponentReady=!1,n.value.ready=!1,r.value="å¯¹æ‰‹å·²æ–­å¼€è¿žæŽ¥";break}break;case"error":switch(m.data.message){case"opponent not yet joined":n.value.ready=!1;break;case"no available public room":$(),i.value=!0;break;default:$(),r.value=`é”™è¯¯: ${m.data.message}`;break}break;case"roomId":e.value=m.data.payload,l.value=!0,n.value.gameStarted=0,n.value.opponentJoined=!1,n.value.opponentReady=!1,n.value.ready=!1;break;case"self guess":m.data.payload.guess.release=new Date(m.data.payload.guess.release).toISOString(),y.value.push(m.data.payload);break;case"opponent guess":u.value.push(m.data.payload);break;case"opponent history":m.data.payload.forEach(P=>{P.release=new Date(P.release).toISOString()}),k.value=m.data.payload;break;case"suggest":v.value=m.data.payload;break;default:console.warn("Unknown message type:",m.type)}},onClose:()=>{l.value=!1,n.value.gameStarted=2,n.value.opponentJoined=!1,n.value.opponentReady=!1,n.value.ready=!1,y.value=[],u.value=[],k.value=[],console.log("WebSocket closed.")},onError:m=>{console.error("WebSocket error:",m)}};async function N(m=d.value,x={}){return o&&c?.readyState===WebSocket.OPEN?Promise.reject(new Error("WebSocket is already connected")):(d.value=m,Object.assign(g,x),new Promise((P,T)=>{c=new WebSocket("/multiplayer"),c.onopen=()=>{o=!0,g.onOpen(),P()},c.onmessage=G=>{const Z=JSON.parse(G.data);g.onMessage(Z)},c.onclose=()=>{o=!1,g.onClose()},c.onerror=G=>{o=!1,g.onError(G),T(G)}}))}async function R(m,x={}){return new Promise((P,T)=>{c&&c.readyState===WebSocket.OPEN?(c.send(JSON.stringify({type:m,userId:d.value,data:x})),P()):T(new Error("WebSocket is not connected"))})}async function $(){return new Promise(m=>{c&&o&&(c.onclose=()=>{o=!1,g.onClose()},c.close()),m()})}return{currentUserId:d,roomId:e,inRoom:l,roomStat:n,selfGuesses:y,opponentCmp:u,opponentOp:k,suggestions:v,errorMsg:r,infoMsg:p,findPublicFailed:i,connect:N,sendMessage:R,close:$}}),we={class:"table-wrapper"},Ce={class:"table-wrapper"},Ne={__name:"MultiTable",setup(c){const o=D(),d=I(()=>l()),e=_(!0);function l(){if(o.opponentOp.length===0)return o.opponentCmp;{e.value=!1;let n=[];for(let r=0;r<o.opponentOp.length;r++)n.push({guess:o.opponentOp[r],comparison:o.opponentCmp[r].comparison});return n}}return(n,r)=>(b(),C(t(S),{vertical:""},{default:a(()=>[s(t(S),{class:"guess-tables-flex",wrap:!1},{default:a(()=>[F("div",we,[s(t(j),{size:"small",bordered:!1},{header:a(()=>[s(t(O),{strong:""},{default:a(()=>r[0]||(r[0]=[f("æˆ‘çš„çŒœæµ‹")])),_:1,__:[0]})]),footer:a(()=>r[1]||(r[1]=[])),default:a(()=>[s(J,{guesses:t(o).selfGuesses,"show-comparison-only":!1},null,8,["guesses"])]),_:1})]),F("div",Ce,[s(t(j),{size:"small",bordered:!1},{header:a(()=>[s(t(O),{strong:""},{default:a(()=>r[2]||(r[2]=[f("å¯¹æ‰‹çŒœæµ‹")])),_:1,__:[2]})]),default:a(()=>[s(J,{guesses:d.value,"show-comparison-only":e.value},null,8,["guesses","show-comparison-only"])]),_:1})])]),_:1}),s(t(S),{style:{transform:"translateX(15px)"}},{default:a(()=>[s(t(V),{placement:"bottom-start",trigger:"hover"},{trigger:a(()=>[s(t(w),{size:"large"},{default:a(()=>r[3]||(r[3]=[f("ä¸€äº›æç¤º")])),_:1,__:[3]})]),default:a(()=>[s(t(S),{vertical:""},{default:a(()=>[s(t(O),null,{default:a(()=>r[4]||(r[4]=[f("çº¢/é»„/ç»¿ï¼šé”™è¯¯/æŽ¥è¿‘/æ­£ç¡®ï¼›")])),_:1,__:[4]}),s(t(O),null,{default:a(()=>r[5]||(r[5]=[f("â†’/â†‘ä»£è¡¨è°œåº•å¹²å‘˜çš„æ—¶é—´æ›´æ™š/æ˜Ÿçº§æ›´é«˜")])),_:1,__:[5]})]),_:1})]),_:1})]),_:1})]),_:1}))}},$e=M(Ne,[["__scopeId","data-v-d384cd11"]]),xe={key:0,style:{"text-align":"center"}},Oe={key:0},ze={key:1,style:{"text-align":"center","margin-top":"16px"}},Ie={__name:"GameRoom",emits:["back"],setup(c,{emit:o}){const d=A(),e=D();W(()=>e.roomStat.gameStarted,(v,g)=>{v===1&&g!==1&&d.success("æ¸¸æˆå¼€å§‹ï¼")}),W(()=>e.errorMsg,v=>{v&&(d.error(v),e.errorMsg="")}),W(()=>e.infoMsg,v=>{v&&(d.info(v),e.infoMsg="")});const l=I(()=>e.roomStat.ready?"å–æ¶ˆå‡†å¤‡":"å‡†å¤‡"),n=I(()=>e.roomStat.ready?"tertiary":"primary"),r=I(()=>e.roomStat.opponentJoined?e.roomStat.opponentReady?"å·²å‡†å¤‡":"æœªå‡†å¤‡":"æœªåŠ å…¥"),p=_(""),i=_([]);async function y(){e.roomStat.ready?await e.sendMessage("unready"):await e.sendMessage("ready")}async function u(v){await e.sendMessage("guess",{guess:v}),p.value="",i.value=[]}function k(){e.roomStat.ready=!1,e.roomStat.gameStarted=0,e.selfGuesses=[],e.opponentOp=[],e.opponentCmp=[]}return U(async()=>{await e.close()}),(v,g)=>(b(),z(q,null,[s(t(S),{vertical:"",align:"center",style:{padding:"32px"}},{default:a(()=>[s(t(E),null,{default:a(()=>[f("æˆ¿é—´ï¼š"+B(t(e).roomId),1)]),_:1}),s(t(S),{align:"center"},{default:a(()=>[t(e).roomStat.gameStarted===1?(b(),z("div",xe,[s(X,{onSelect:u})])):(b(),C(t(O),{key:1},{default:a(()=>[f("å¯¹æ‰‹çŠ¶æ€ï¼š"+B(r.value),1)]),_:1})),s(t(w),{secondary:"",size:"large",onClick:g[0]||(g[0]=N=>{v.$emit("back")})},{default:a(()=>g[1]||(g[1]=[f("è¿”å›ž")])),_:1,__:[1]})]),_:1})]),_:1}),t(e).roomStat.gameStarted===1||t(e).roomStat.gameStarted===2?(b(),z("div",Oe,[s(t(S),{justify:"center"},{default:a(()=>[s($e),t(e).roomStat.gameStarted===2?(b(),C(t(w),{key:0,onClick:k,secondary:"",size:"large"},{default:a(()=>g[2]||(g[2]=[f(" å…³é—­è¡¨æ ¼ ")])),_:1,__:[2]})):H("",!0)]),_:1})])):(b(),z("div",ze,[s(t(w),{onClick:y,type:n.value,disabled:!t(e).roomStat.opponentJoined,round:"",secondary:"",size:"large"},{default:a(()=>[f(B(l.value),1)]),_:1},8,["type","disabled"])]))],64))}},Me=M(Ie,[["__scopeId","data-v-ed0ae645"]]),Re={__name:"MultiPlayerStart",emits:["back"],setup(c){const o=D(),d=A(),e=_(""),l=_(!0);async function n(){await o.connect(),await o.sendMessage("create",{public:l.value})}async function r(){await o.connect(),await o.sendMessage("join",{roomId:e.value})}async function p(){await o.connect(),await o.sendMessage("find")}W(()=>o.findPublicFailed,y=>{y&&(o.findPublicFailed=!1,d.error("æ²¡æœ‰å¯ç”¨çš„å…¬å…±æˆ¿é—´ï¼Œè¯·ç¨åŽå†è¯•"))});function i(){ae(()=>{o.inRoom=!1})}return U(async()=>{await o.close()}),(y,u)=>t(o).inRoom?(b(),C(Me,{key:0,onBack:i})):(b(),C(t(S),{key:1,vertical:"",align:"center",style:{padding:"32px"}},{default:a(()=>[s(t(E),{style:{"text-align":"center"}},{default:a(()=>u[3]||(u[3]=[f("åŒäººæ¨¡å¼")])),_:1,__:[3]}),s(t(S),{justify:"center",size:10},{default:a(()=>[s(t(w),{type:"primary",size:"large",onClick:p},{default:a(()=>u[4]||(u[4]=[f("å¯»æ‰¾å…¬å…±æˆ¿é—´")])),_:1,__:[4]}),s(t(w),{secondary:"",size:"large",onClick:u[0]||(u[0]=k=>y.$emit("back"))},{default:a(()=>u[5]||(u[5]=[f("è¿”å›ž")])),_:1,__:[5]})]),_:1}),s(t(j),null,{default:a(()=>[s(t(S),{justify:"center",size:5},{default:a(()=>[s(t(ie),{value:e.value,"onUpdate:value":u[1]||(u[1]=k=>e.value=k),placeholder:"è¾“å…¥æˆ¿é—´å·",style:{width:"120px"}},null,8,["value"]),s(t(w),{type:"primary",size:"large",onClick:r},{default:a(()=>u[6]||(u[6]=[f("åŠ å…¥æˆ¿é—´")])),_:1,__:[6]})]),_:1})]),_:1}),s(t(j),{size:"small"},{default:a(()=>[s(t(de),{checked:l.value,"onUpdate:checked":u[2]||(u[2]=k=>l.value=k),size:"large"},{default:a(()=>u[7]||(u[7]=[f("å…¬å…±æ¸¸æˆ")])),_:1,__:[7]},8,["checked"]),s(t(w),{type:"primary",size:"large",onClick:n},{default:a(()=>u[8]||(u[8]=[f("åˆ›å»ºæˆ¿é—´")])),_:1,__:[8]})]),_:1})]),_:1}))}},Pe=M(Re,[["__scopeId","data-v-b5523bda"]]),je={key:0},Ge={key:1},Be={key:2},We={__name:"App",setup(c){const o=_("choose");return(d,e)=>(b(),C(t(pe),null,{default:a(()=>[s(t(K),null,{default:a(()=>[o.value==="choose"?(b(),z("div",je,[s(t(S),{vertical:"",align:"center",style:{padding:"32px"}},{default:a(()=>[s(t(E),null,{default:a(()=>e[4]||(e[4]=[f("çŒœå¹²å‘˜ - æ˜Žæ—¥æ–¹èˆŸ")])),_:1,__:[4]}),s(t(w),{type:"primary",size:"large",onClick:e[0]||(e[0]=l=>o.value="single")},{default:a(()=>e[5]||(e[5]=[f(" å•äººæ¨¡å¼ ")])),_:1,__:[5]}),s(t(w),{type:"primary",size:"large",onClick:e[1]||(e[1]=l=>o.value="multi")},{default:a(()=>e[6]||(e[6]=[f(" åŒäººæ¨¡å¼ ")])),_:1,__:[6]}),s(t(S),null,{default:a(()=>[s(t(O),{depth:"3",style:{"font-size":"12px"}},{default:a(()=>e[7]||(e[7]=[f("ä½œè€…ï¼šSNINMNON")])),_:1,__:[7]}),s(t(ce),{href:"https://github.com/SNINMNON/OperatorGuessing",style:{"font-size":"12px"}},{default:a(()=>e[8]||(e[8]=[f("Github ä»“åº“ ")])),_:1,__:[8]})]),_:1})]),_:1})])):o.value==="single"?(b(),z("div",Ge,[s(Se,{onBack:e[2]||(e[2]=l=>o.value="choose")})])):o.value==="multi"?(b(),z("div",Be,[s(Pe,{onBack:e[3]||(e[3]=l=>o.value="choose")})])):H("",!0)]),_:1})]),_:1}))}},Ee=M(We,[["__scopeId","data-v-30aeb19e"]]),Te=se(),Y=oe(Ee);Y.use(Te);Y.mount("#app");
