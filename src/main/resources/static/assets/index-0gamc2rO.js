import{r as y,I as C,J as k,K as a,L as s,M as e,j as m,c as O,m as se,o as oe,N as J,O as h,P,F as q,Q as ne,w as U,G as H,R as K,n as le,S as re,U as ue}from"./vue-vendor-Dl-1-qQW.js";import{N as ie,B as S,a as b,b as de,c as ce,d as Q,e as j,f as B,g as pe,h as fe,u as F,i as X,j as I,k as Y,l as me,m as ye,n as ve,o as ge,p as _e,q as ke}from"./naive-ui-DdR8ZSpy.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))t(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function u(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerPolicy&&(o.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?o.credentials="include":l.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(l){if(l.ep)return;l.ep=!0;const o=u(l);fetch(l.href,o)}})();const W="/api";async function Z(f){return await(await fetch(`${W}/start?rarity=${f}`,{credentials:"include"})).json()}async function be(f){return await(await fetch(`${W}/suggest?query=${encodeURIComponent(f)}`,{credentials:"include"})).json()}async function we(f){return await(await fetch(`${W}/guess?name=${encodeURIComponent(f)}`,{method:"POST",credentials:"include"})).json()}const x=(f,n)=>{const u=f.__vccOpts||f;for(const[t,l]of n)u[t]=l;return u},Se={__name:"StartScreen",emits:["start","rarity","back"],setup(f,{emit:n}){const u=n,t=y(0),l=[{label:"任意星级",value:0},...Array.from({length:6},(r,i)=>({label:`${i+1}星`,value:i+1}))];async function o(){await Z(t.value),u("rarity",t.value),u("start")}return(r,i)=>(k(),C(e(b),{justify:"center",size:"small"},{default:a(()=>[s(e(ie),{value:t.value,"onUpdate:value":i[0]||(i[0]=p=>t.value=p),filterable:"",options:l,size:"large"},null,8,["value"]),s(e(S),{type:"primary",size:"large",onClick:o},{default:a(()=>i[2]||(i[2]=[m("开始猜测")])),_:1,__:[2]}),s(e(S),{secondary:"",size:"large",onClick:i[1]||(i[1]=p=>r.$emit("back"))},{default:a(()=>i[3]||(i[3]=[m(" 返回 ")])),_:1,__:[3]})]),_:1}))}},Ce=x(Se,[["__scopeId","data-v-d1b0a6f9"]]),Ne={__name:"InputOp",emits:["select"],setup(f,{emit:n}){const u=n,t=y(""),l=y([]),o=O(()=>l.value.map(p=>({label:p,value:p})));async function r(){if(!t.value){l.value=[];return}l.value=await be(t.value)}function i(p){u("select",p),t.value="",l.value=[]}return(p,c)=>(k(),C(e(de),{value:t.value,"onUpdate:value":[c[0]||(c[0]=d=>t.value=d),r],options:o.value,placeholder:"输入干员名称...",onSelect:i,"clear-after-select":"",style:{width:"300px"},size:"large"},null,8,["value","options"]))}},V=x(Ne,[["__scopeId","data-v-6ba31026"]]),Me={__name:"GuessTable",props:{guesses:Array,showComparisonOnly:Boolean},setup(f){const n=f,u=[{key:"name",title:"姓名"},{key:"role",title:"职业"},{key:"rarity",title:"星级"},{key:"gender",title:"性别"},{key:"faction",title:"阵营"},{key:"position",title:"站位"},{key:"race",title:"种族"},{key:"release",title:"实装时间"}],t=O(()=>{const r=[];for(let i=0;i<u.length;i++){const p=u[i],c={title:p.title,key:p.key,align:"center",render:d=>{const g=d[p.key];return se("span",[g.value," ",g.msg])},cellProps:d=>({style:{backgroundColor:d[p.key].bgColor}})};r.push(c)}return r});function l(r,i){const[p,c,d]=["#c8e6c9","#ffcdd2","#fff9c4"],g={equal:[p,"✓"],different:[c,"×"],close:[d,"○"],"too high":[c,"⇊"],"too low":[c,"⇈"],"too late":[c,"⇇"],"too soon":[c,"⇉"],"close high":[d,"↓"],"close low":[d,"↑"],"close late":[d,"←"],"close soon":[d,"→"]},[v,N]=g[i]||["#e0e0e0","❔"];return{value:r,msg:N,bgColor:v}}const o=O(()=>{const r=[];for(let i=0;i<n.guesses.length;i++){const p=n.guesses[i],c=p.guess,d=p.comparison,g={};for(let v=0;v<u.length;v++){const N=u[v];let M="";!n.showComparisonOnly&&c&&(N.key==="release"&&c.release?M=c.release.slice(2,10):M=c[N.key]||"");const G=d[N.key];g[N.key]=l(M,G)}r.push(g)}return r});return(r,i)=>(k(),C(e(Q),{columns:t.value,data:o.value,bordered:!0,size:"small",class:"guess-table"},{empty:a(()=>[s(e(ce),{style:{color:"#c2c2c2"}},{default:a(()=>i[0]||(i[0]=[m("猜测记录")])),_:1,__:[0]})]),_:1},8,["columns","data"]))}},D=x(Me,[["__scopeId","data-v-fe096c06"]]),$e=["src"],Oe={__name:"GameOverModal",props:{showModal:Boolean,message:String,answer:Object,type:String},emits:["close"],setup(f,{emit:n}){const u=f,t=n,l=O({get:()=>u.showModal,set:()=>t("close")}),o=O(()=>u.type?u.type:"info"),r=[{key:"role",title:"职业"},{key:"rarity",title:"星级"},{key:"gender",title:"性别"},{key:"faction",title:"阵营"},{key:"position",title:"站位"},{key:"race",title:"种族"},{key:"release",title:"实装时间"}],i=O(()=>r.map(c=>({title:c.title,key:c.key,align:"center"})));function p(){if(!u.answer||!u.answer.name)return[];const c={...u.answer};return delete c.image,delete c.name,c.release=c.release.slice(2,10),[c]}return oe(()=>{document.querySelectorAll('[aria-hidden="true"]').forEach(c=>c.removeAttribute("aria-hidden"))}),(c,d)=>(k(),C(e(fe),{show:l.value,"onUpdate:show":d[0]||(d[0]=g=>l.value=g)},{default:a(()=>[s(e(j),{title:"正确答案是：",size:"huge",role:"dialog"},{default:a(()=>[s(e(b),{vertical:"",align:"center"},{default:a(()=>[s(e(B),{style:{"margin-bottom":"0"}},{default:a(()=>[m(h(u.answer.name),1)]),_:1}),s(e(pe),{type:o.value},{default:a(()=>[m(h(u.message),1)]),_:1},8,["type"]),J("img",{src:u.answer.image,class:"image"},null,8,$e),s(e(Q),{columns:i.value,data:p(),class:"guess-table"},null,8,["columns","data"])]),_:1})]),_:1})]),_:1},8,["show"]))}},ee=x(Oe,[["__scopeId","data-v-3771872f"]]),Ie={__name:"GameScreen",props:["rarity"],emits:["back"],setup(f){const n=y([]),u=f,t=F(),l=y(!1),o=y(""),r=y({});function i(){l.value=!1,o.value="",r.value={}}async function p(g){const v=await we(g);if(v.error)return alert(v.error);n.value.push(v),v.correct&&(o.value="你猜对了",r.value=v.guess,l.value=!0)}async function c(){n.value=[],await Z(u.rarity),t.info("已按当前稀有度重新设置谜底干员")}function d(){return u.rarity===0?"任意":u.rarity}return(g,v)=>(k(),P(q,null,[s(e(b),{class:"game-button-flex",size:"small",justify:"center",align:"center"},{default:a(()=>[s(V,{onSelect:p}),s(e(b),{size:"small",justify:"center",align:"center"},{default:a(()=>[s(e(S),{type:"primary",size:"large",onClick:c},{default:a(()=>v[1]||(v[1]=[m("重新开始")])),_:1,__:[1]}),s(e(S),{secondary:"",size:"large",onClick:v[0]||(v[0]=N=>g.$emit("back"))},{default:a(()=>v[2]||(v[2]=[m("返回")])),_:1,__:[2]})]),_:1})]),_:1}),s(e(b),{vertical:"",align:"center"},{default:a(()=>[s(e(j),{bordered:!1},{footer:a(()=>[s(e(X),{placement:"bottom-start",trigger:"hover"},{trigger:a(()=>[s(e(S),{size:"large"},{default:a(()=>v[3]||(v[3]=[m("一些提示")])),_:1,__:[3]})]),default:a(()=>[s(e(b),{vertical:""},{default:a(()=>[s(e(I),null,{default:a(()=>v[4]||(v[4]=[m("红/黄/绿：错误/接近/正确")])),_:1,__:[4]}),s(e(I),null,{default:a(()=>v[5]||(v[5]=[m("→/↑代表谜底干员的时间更晚/星级更高")])),_:1,__:[5]}),s(e(I),null,{default:a(()=>[m("当前星级："+h(d()),1)]),_:1})]),_:1})]),_:1})]),default:a(()=>[s(D,{guesses:n.value},null,8,["guesses"])]),_:1})]),_:1}),s(ee,{"show-modal":l.value,message:o.value,answer:r.value,onClose:i,type:"success"},null,8,["show-modal","message","answer"])],64))}},xe=x(Ie,[["__scopeId","data-v-82bd119b"]]),ze={__name:"SinglePlayerStart",emits:["back"],setup(f,{emit:n}){const u=n,t=y("start"),l=y(0);function o(i){l.value=i}function r(){u("back")}return(i,p)=>(k(),C(e(Y),null,{default:a(()=>[s(e(b),{vertical:"",align:"center",style:{padding:"32px"}},{default:a(()=>[s(e(B),null,{default:a(()=>p[2]||(p[2]=[m("单人模式")])),_:1,__:[2]}),t.value==="start"?(k(),C(Ce,{key:0,onStart:p[0]||(p[0]=c=>t.value="game"),onRarity:o,onBack:r})):(k(),C(xe,{key:1,onBack:p[1]||(p[1]=c=>t.value="start"),rarity:l.value},null,8,["rarity"]))]),_:1})]),_:1}))}},L=ne("websocket",()=>{let f=null,n=!1;const u=y(crypto.randomUUID()),t=y(""),l=y(!1),o=y({ready:!1,gameStarted:0,opponentJoined:!1,opponentReady:!1}),r=y(""),i=y(""),p=y(!1),c=y([]),d=y([]),g=y([]),v=y([]),N=y({}),M={onOpen:()=>console.log("Connected to server."),onMessage:_=>{const z=_.userId===u.value;switch(_.type){case"broadcast":switch(_.data.message){case"join":if(o.value.opponentJoined=!0,o.value.opponentReady=!1,T(),z){t.value=_.data.roomId,l.value=!0;break}else{i.value="对手已加入房间";break}case"ready":z?o.value.ready=!0:(o.value.gameStarted=0,c.value=[],d.value=[],g.value=[],o.value.opponentReady=!0,i.value="对手已准备");break;case"unready":z?o.value.ready=!1:(o.value.opponentReady=!1,i.value="对手取消准备");break;case"start":o.value.gameStarted=1;break;case"win":o.value.gameStarted=2,o.value.opponentJoined=!0,o.value.opponentReady=!1,o.value.ready=!1,i.value=z?"你赢了":"你输了",_.data.answer.release=new Date(_.data.answer.release).toISOString(),N.value=_.data.answer;break;case"disconnect":o.value.gameStarted=2,o.value.opponentJoined=!1,o.value.opponentReady=!1,o.value.ready=!1,r.value="对手已断开连接";break}break;case"error":switch(_.data.message){case"opponent not yet joined":o.value.ready=!1;break;case"no available public room":$(),p.value=!0;break;default:$(),r.value=`错误: ${_.data.message}`;break}break;case"roomId":t.value=_.data.payload,l.value=!0,o.value.gameStarted=0,o.value.opponentJoined=!1,o.value.opponentReady=!1,o.value.ready=!1;break;case"self guess":_.data.payload.guess.release=new Date(_.data.payload.guess.release).toISOString(),c.value.push(_.data.payload);break;case"opponent guess":d.value.push(_.data.payload);break;case"opponent history":_.data.payload.forEach(R=>{R.release=new Date(R.release).toISOString()}),g.value=_.data.payload;break;case"suggest":v.value=_.data.payload;break;default:console.warn("Unknown message type:",_.type)}},onClose:()=>{l.value=!1,o.value.opponentJoined=!1,o.value.opponentReady=!1,T(),o.value.gameStarted=2,console.log("WebSocket closed.")},onError:_=>{console.error("WebSocket error:",_)}};async function G(_=u.value,z={}){return n&&f?.readyState===WebSocket.OPEN?Promise.reject(new Error("WebSocket is already connected")):(u.value=_,Object.assign(M,z),new Promise((R,E)=>{f=new WebSocket("/multiplayer"),f.onopen=()=>{n=!0,M.onOpen(),R()},f.onmessage=A=>{const ae=JSON.parse(A.data);M.onMessage(ae)},f.onclose=()=>{n=!1,M.onClose()},f.onerror=A=>{n=!1,M.onError(A),E(A)}}))}async function w(_,z={}){return new Promise((R,E)=>{f&&f.readyState===WebSocket.OPEN?(f.send(JSON.stringify({type:_,userId:u.value,data:z})),R()):E(new Error("WebSocket is not connected"))})}async function $(){return new Promise(_=>{f&&n&&(f.onclose=()=>{n=!1,M.onClose()},f.close()),_()})}function T(){o.value.ready=!1,o.value.gameStarted=0,c.value=[],d.value=[],g.value=[]}return{currentUserId:u,roomId:t,inRoom:l,roomStat:o,selfGuesses:c,opponentCmp:d,opponentOp:g,suggestions:v,errorMsg:r,infoMsg:i,findPublicFailed:p,answer:N,connect:G,sendMessage:w,close:$,resetTable:T}}),Pe={class:"table-wrapper"},Re={class:"table-wrapper"},he={__name:"MultiTable",setup(f){const n=L(),u=O(()=>l()),t=y(!0);function l(){if(n.opponentOp.length===0)return n.opponentCmp;{t.value=!1;let o=[];for(let r=0;r<n.opponentOp.length;r++)o.push({guess:n.opponentOp[r],comparison:n.opponentCmp[r].comparison});return o}}return(o,r)=>(k(),C(e(b),{vertical:""},{default:a(()=>[s(e(b),{class:"guess-tables-flex",wrap:!1},{default:a(()=>[J("div",Pe,[s(e(j),{size:"small",bordered:!1,"header-style":"padding: 0px"},{header:a(()=>[s(e(I),{strong:"",class:"small-header"},{default:a(()=>r[0]||(r[0]=[m("我的猜测")])),_:1,__:[0]})]),footer:a(()=>r[1]||(r[1]=[])),default:a(()=>[s(D,{guesses:e(n).selfGuesses,"show-comparison-only":!1},null,8,["guesses"])]),_:1})]),J("div",Re,[s(e(j),{size:"small",bordered:!1,"header-style":"padding: 0px"},{header:a(()=>[s(e(I),{strong:"",class:"small-header"},{default:a(()=>r[2]||(r[2]=[m("对手猜测")])),_:1,__:[2]})]),default:a(()=>[s(D,{guesses:u.value,"show-comparison-only":t.value},null,8,["guesses","show-comparison-only"])]),_:1})])]),_:1}),s(e(b),{style:{transform:"translateX(15px)"}},{default:a(()=>[s(e(X),{placement:"bottom-start",trigger:"hover"},{trigger:a(()=>[s(e(S),{size:"large"},{default:a(()=>r[3]||(r[3]=[m("一些提示")])),_:1,__:[3]})]),default:a(()=>[s(e(b),{vertical:""},{default:a(()=>[s(e(I),null,{default:a(()=>r[4]||(r[4]=[m("红/黄/绿：错误/接近/正确；")])),_:1,__:[4]}),s(e(I),null,{default:a(()=>r[5]||(r[5]=[m("→/↑代表谜底干员的时间更晚/星级更高")])),_:1,__:[5]})]),_:1})]),_:1})]),_:1})]),_:1}))}},je=x(he,[["__scopeId","data-v-c9d0212f"]]),Ge={key:0,style:{"text-align":"center"}},Be={key:0},Te={key:1,style:{"text-align":"center","margin-top":"16px"}},Ae={__name:"GameRoom",emits:["back"],setup(f,{emit:n}){const u=F(),t=L(),l=y(!1),o=y(""),r=y({}),i=y("");function p(){l.value=!1,o.value="",r.value={},i.value=""}U(()=>t.roomStat.gameStarted,(w,$)=>{w===1&&$!==1&&u.success("游戏开始！")}),U(()=>t.errorMsg,w=>{w&&(u.error(w),t.errorMsg="")}),U(()=>t.infoMsg,w=>{w&&(w==="你赢了"||w==="你输了"?(o.value=w,r.value=t.answer,l.value=!0,i.value=w==="你赢了"?"success":"danger"):(p(),u.info(w),t.infoMsg=""))});const c=O(()=>t.roomStat.ready?"取消准备":"准备"),d=O(()=>t.roomStat.ready?"tertiary":"primary"),g=O(()=>t.roomStat.opponentJoined?t.roomStat.opponentReady?"已准备":"未准备":"未加入"),v=y(""),N=y([]);async function M(){t.roomStat.ready?await t.sendMessage("unready"):await t.sendMessage("ready")}async function G(w){await t.sendMessage("guess",{guess:w}),v.value="",N.value=[]}return H(async()=>{await t.close()}),(w,$)=>(k(),P(q,null,[s(e(b),{vertical:"",align:"center",style:{padding:"32px"}},{default:a(()=>[s(e(B),null,{default:a(()=>[m("房间："+h(e(t).roomId),1)]),_:1}),s(e(b),{align:"center"},{default:a(()=>[e(t).roomStat.gameStarted===1?(k(),P("div",Ge,[s(V,{onSelect:G})])):(k(),C(e(I),{key:1},{default:a(()=>[m("对手状态："+h(g.value),1)]),_:1})),s(e(S),{secondary:"",size:"large",onClick:$[0]||($[0]=T=>{e(t).resetTable,w.$emit("back")})},{default:a(()=>$[1]||($[1]=[m("返回")])),_:1,__:[1]})]),_:1})]),_:1}),e(t).roomStat.gameStarted===1||e(t).roomStat.gameStarted===2?(k(),P("div",Be,[s(e(b),{justify:"center"},{default:a(()=>[s(je),e(t).roomStat.gameStarted===2?(k(),C(e(S),{key:0,onClick:e(t).resetTable,secondary:"",size:"large"},{default:a(()=>$[2]||($[2]=[m(" 关闭表格 ")])),_:1,__:[2]},8,["onClick"])):K("",!0)]),_:1})])):(k(),P("div",Te,[s(e(S),{onClick:M,type:d.value,disabled:!e(t).roomStat.opponentJoined,round:"",secondary:"",size:"large"},{default:a(()=>[m(h(c.value),1)]),_:1},8,["type","disabled"])])),s(ee,{"show-modal":l.value,message:o.value,answer:r.value,onClose:p,type:i.value},null,8,["show-modal","message","answer","type"])],64))}},Ue=x(Ae,[["__scopeId","data-v-32f86a68"]]),Ee={__name:"MultiPlayerStart",emits:["back"],setup(f){const n=L(),u=F(),t=y(""),l=y(!0);async function o(){await n.connect(),await n.sendMessage("create",{public:l.value})}async function r(){await n.connect(),await n.sendMessage("join",{roomId:t.value})}async function i(){await n.connect(),await n.sendMessage("find")}U(()=>n.findPublicFailed,c=>{c&&(n.findPublicFailed=!1,u.error("没有可用的公共房间，请稍后再试"))});function p(){le(()=>{n.inRoom=!1})}return H(async()=>{await n.close()}),(c,d)=>e(n).inRoom?(k(),C(Ue,{key:0,onBack:p})):(k(),C(e(b),{key:1,vertical:"",align:"center",style:{padding:"32px"}},{default:a(()=>[s(e(B),{style:{"text-align":"center"}},{default:a(()=>d[3]||(d[3]=[m("双人模式")])),_:1,__:[3]}),s(e(b),{justify:"center",size:10},{default:a(()=>[s(e(S),{type:"primary",size:"large",onClick:i},{default:a(()=>d[4]||(d[4]=[m("寻找公共房间")])),_:1,__:[4]}),s(e(S),{secondary:"",size:"large",onClick:d[0]||(d[0]=g=>c.$emit("back"))},{default:a(()=>d[5]||(d[5]=[m("返回")])),_:1,__:[5]})]),_:1}),s(e(j),null,{default:a(()=>[s(e(b),{justify:"center",size:5},{default:a(()=>[s(e(me),{value:t.value,"onUpdate:value":d[1]||(d[1]=g=>t.value=g),placeholder:"输入房间号",style:{width:"120px"}},null,8,["value"]),s(e(S),{type:"primary",size:"large",onClick:r},{default:a(()=>d[6]||(d[6]=[m("加入房间")])),_:1,__:[6]})]),_:1})]),_:1}),s(e(j),{size:"small"},{default:a(()=>[s(e(ye),{checked:l.value,"onUpdate:checked":d[2]||(d[2]=g=>l.value=g),size:"large"},{default:a(()=>d[7]||(d[7]=[m("公共游戏")])),_:1,__:[7]},8,["checked"]),s(e(S),{type:"primary",size:"large",onClick:o},{default:a(()=>d[8]||(d[8]=[m("创建房间")])),_:1,__:[8]})]),_:1})]),_:1}))}},Je=x(Ee,[["__scopeId","data-v-fdfe50dc"]]),De={key:0},Fe={key:1},We={key:2},Le={__name:"App",setup(f){const n=y("choose");return(u,t)=>(k(),C(e(ke),null,{default:a(()=>[s(e(ve)),s(e(Y),null,{default:a(()=>[s(e(ge),null,{default:a(()=>[n.value==="choose"?(k(),P("div",De,[s(e(b),{vertical:"",align:"center",style:{padding:"32px"}},{default:a(()=>[s(e(B),null,{default:a(()=>t[4]||(t[4]=[m("猜干员 - 明日方舟")])),_:1,__:[4]}),s(e(S),{type:"primary",size:"large",onClick:t[0]||(t[0]=l=>n.value="single"),class:"big-button"},{default:a(()=>t[5]||(t[5]=[m(" 单人模式 ")])),_:1,__:[5]}),s(e(S),{type:"primary",size:"large",onClick:t[1]||(t[1]=l=>n.value="multi"),class:"big-button"},{default:a(()=>t[6]||(t[6]=[m(" 双人模式 ")])),_:1,__:[6]}),s(e(b),null,{default:a(()=>[s(e(I),{depth:"3",style:{"font-size":"12px"}},{default:a(()=>t[7]||(t[7]=[m("作者：SNINMNON")])),_:1,__:[7]}),s(e(_e),{href:"https://github.com/SNINMNON/OperatorGuessing",style:{"font-size":"12px"}},{default:a(()=>t[8]||(t[8]=[m("Github 仓库 ")])),_:1,__:[8]})]),_:1})]),_:1})])):n.value==="single"?(k(),P("div",Fe,[s(ze,{onBack:t[2]||(t[2]=l=>n.value="choose")})])):n.value==="multi"?(k(),P("div",We,[s(Je,{onBack:t[3]||(t[3]=l=>n.value="choose")})])):K("",!0)]),_:1})]),_:1})]),_:1}))}},qe=x(Le,[["__scopeId","data-v-3ab928ac"]]),He=re(),te=ue(qe);te.use(He);te.mount("#app");
